sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/MessageBox"],function(t,e,r,s,l){"use strict";var o=s.EdmType;return t.extend("Jepco.ISU.DM.smartmeter.controller.Report",{onBuildingExcelRepBTNPress:function(){var t=this.getView().byId("idDateFm").getDateValue().getFullYear();var e=this.getView().byId("idDateFm").getDateValue().getMonth()+1;e=e.toString().length<2?"0"+e.toString():e.toString();var s=this.getView().byId("idDateFm").getDateValue().getDate();s=s.toString().length<2?"0"+s.toString():s.toString();var o=[t,e,s].join("");t=this.getView().byId("idDateTo").getDateValue().getFullYear();e=this.getView().byId("idDateTo").getDateValue().getMonth()+1;e=e.toString().length<2?"0"+e.toString():e.toString();s=this.getView().byId("idDateTo").getDateValue().getDate();s=s.toString().length<2?"0"+s.toString():s.toString();var a=[t,e,s].join("");var n=this.getView().byId("idBuildUser").getValue();var p="'"+o.replace(/[-]/g,"");var c=a.replace(/[-]/g,"")+"'";if(n==""){n="'ALL'"}else{n="'"+n+"'"}var i="CommId ge "+p+"-"+c+" or CommId eq "+n;var d=this;$.ajax({type:"POST",url:"https://portal.jepco.com.jo/JepcoSAPProxyPRD/SapProxy/GetReport",dataType:"json",contentType:"application/json",data:JSON.stringify({ReportParm:i}),success:function(t,e,s){console.log(t);for(let e=0;e<t.d.results.length;e++){const r=t.d.results[e].commstrdtl.results[0].tenantName.split("-");var l={fileNo:r[1],oldMeterNo:r[2].replace(/^0+/,""),oldMeterRDNGI:r[3].replace(/^0+/,""),oldMeterRDNGE:r[4].replace(/^0+/,""),newMeterNO:r[5].replace(/^0+/,""),newMeterRDNGI:r[6].replace(/^0+/,""),newMeterRDNGE:r[7].replace(/^0+/,""),noteType:r[8],noteDesc:r[9]};t.d.results[e].commstrdtl.results.push(l);t.d.results[e].transDt=t.d.results[e].transDt.split("T")[0];t.d.results[e].commstrdtl.results[0].transDt=t.d.results[e].commstrdtl.results[0].transDt.split("T")[0];if(t.d.results[e].jepcoBoxStatus==1){t.d.results[e].jepcoBoxStatus="بحاجة لتركيب صندوق اتصالات"}if(t.d.results[e].jepcoBoxStatus==2){t.d.results[e].jepcoBoxStatus="داخل وحده القاطع الرئيسي"}if(t.d.results[e].jepcoBoxStatus==3){t.d.results[e].jepcoBoxStatus="تم تركيب الصندوق"}if(t.d.results[e].connectMethod==1){t.d.results[e].connectMethod="كيبل ارضي من العمود"}if(t.d.results[e].connectMethod==2){t.d.results[e].connectMethod="كيبل ارضي خاص"}if(t.d.results[e].connectMethod==3){t.d.results[e].connectMethod="شبكة هوائية من العمود"}if(t.d.results[e].connectMethod==4){t.d.results[e].connectMethod="كيبل محوري من العمود"}if(t.d.results[e].commStatus==1){t.d.results[e].commStatus="يوجد صندوق الياف ضوئية ورقم"}if(t.d.results[e].commStatus==2){t.d.results[e].commStatus="يوجد صندوق الياف ضوئية بدون رقم"}if(t.d.results[e].commId==0||t.d.results[e].commId.charAt(0)=="E"){t.d.results[e].commId=""}if(t.d.results[e].commstrdtl.results[0].commId==0||t.d.results[e].commstrdtl.results[0].commId.charAt(0)=="E"){t.d.results[e].commstrdtl.results[0].commId=""}if(t.d.results[e].commstrdtl.results[0].owner==1){t.d.results[e].commstrdtl.results[0].owner="مالك"}if(t.d.results[e].commstrdtl.results[0].owner==2){t.d.results[e].commstrdtl.results[0].owner="مستأجر"}if(t.d.results[e].commstrdtl.results[0].owner==3){t.d.results[e].commstrdtl.results[0].owner="غير معروف"}var o=t.d.results[e].commstrdtl.results[0].tenantName;var a=o.toString().length<2?"0"+o.toString():o.toString().substr(0,2);var n=o.toString().length<2?"0"+o.toString():o.toString().substr(2,2);var p=o.toString().length<2?"0"+o.toString():o.toString().substr(4,2);t.d.results[e].commstrdtl.results[0].tenantName=[a,n,p].join(":")}var c=new sap.ui.model.json.JSONModel;var i=t;c.setData(i);m=c.getProperty("/d/results");console.log(c);var u,m,g,y;u=d.createColumnConfig();console.log(u);g={workbook:{columns:u},dataSource:m};y=new r(g);y.build().then(function(){MessageToast.show("Spreadsheet export has finished")}).finally(y.destroy)},error:function(t){console.log(t);l.error(t.responseJSON.errors.error.message.value)}})},createColumnConfig:function(){var t=[{label:"رقم الموقع",property:"buildingId",type:o.String,scale:0},{label:"المحافظة",property:"regionDesc",type:o.String,scale:0},{label:"المنطقة",property:"cityDesc",type:o.String,scale:0},{label:"الحي",property:"districtDesc",type:o.String,scale:0},{label:"اسم الشارع",property:"streetDesc",type:o.String,scale:0},{label:"رقم البناية",property:"biuldingNo",type:o.String,scale:0},{label:"اقرب معلم",property:"landmark",type:o.String,scale:0},{label:"حالة صندوق الالياف الضوئية",property:"jepcoBoxStatus",type:o.String,scale:0},{label:"رقم صندوق الالياف الضوئية",property:"commId",type:o.String,scale:0},{label:"حالة صندوق الاتصالات ",property:"commStatus",type:o.String,scale:0},{label:"طريقة التوصيل",property:"connectMethod",type:o.String,scale:0},{label:"رقم العمود",property:"electricPoleId",type:o.String,scale:0},{label:"خط الطول",property:"latitude",type:o.String,scale:0},{label:"خط العرض",property:"longitude",type:o.String,scale:0},{label:"المستخدم",property:"ui5user",type:o.String,scale:0},{label:"التاريخ",property:"transDt",type:o.String,scale:0},{label:"رقم الشقة",property:"commstrdtl/results/0/apartmentNo",type:o.String,scale:0},{label:"رقم الطابق",property:"commstrdtl/results/0/floorNo",type:o.String,scale:0},{label:"الرقم الوطني",property:"commstrdtl/results/0/nationalId",type:o.String,scale:0},{label:"المالك",property:"commstrdtl/results/0/owner",type:o.String,scale:0},{label:"رقم الهاتف",property:"commstrdtl/results/0/phoneNo",type:o.String,scale:0},{label:"وقت التبديل",property:"commstrdtl/results/0/tenantName",type:o.String,scale:0},{label:"تاريخ التبديل",property:"commstrdtl/results/0/transDt",type:o.String,scale:0},{label:"الاسم الاول",property:"commstrdtl/results/0/tnameFrst",type:o.String,scale:0},{label:"اسم الاب",property:"commstrdtl/results/0/tnameScnd",type:o.String,scale:0},{label:" اسم الجد",property:"commstrdtl/results/0/tnameThrd",type:o.String,scale:0},{label:" العائلة",property:"commstrdtl/results/0/tnameFmly",type:o.String,scale:0},{label:"رقم الملف",property:"commstrdtl/results/1/fileNo",type:o.String,scale:0},{label:"رقم العداد القديم",property:"commstrdtl/results/1/oldMeterNo",type:o.String,scale:0},{label:"قراءة الرفع المصدرة",property:"commstrdtl/results/1/oldMeterRDNGI",type:o.String,scale:0},{label:"قراءة الرفع المستورده",property:"commstrdtl/results/1/oldMeterRDNGE",type:o.String,scale:0},{label:"رقم العدادا الجديد",property:"commstrdtl/results/1/newMeterNO",type:o.String,scale:0},{label:"قراءة التركيب المصدرة",property:"commstrdtl/results/1/newMeterRDNGI",type:o.String,scale:0},{label:"قراءة التركيب المستوردة",property:"commstrdtl/results/1/newMeterRDNGE",type:o.String,scale:0},{label:"نوع الملاحظة",property:"commstrdtl/results/1/noteType",type:o.String,scale:0},{label:"وصف الملاحظة",property:"commstrdtl/results/1/noteDesc",type:o.String,scale:0}];return t}})});