sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/m/MessageBox","sap/ui/core/BusyIndicator","sap/m/MessageToast","sap/ui/export/library"],function(e,a,t,r,l,o,s){"use strict";var p="";var c=JSON.parse(localStorage.getItem("engTechUser"));var p={ui5User:c,status:[1,4]};var n={ui5User:c,status:[1,2,3,4]};return e.extend("Jepco.ISU.DM.smartmeter.controller.NewMeterRep",{onNewMeterRepExcelBTNPress:function(){var e=JSON.stringify(p);var a={async:true,crossDomain:true,url:"https://portal.jepco.com.jo/MeterReplacmentPortalApisPRD/api/TbMeterReplacment/GetAllDataWithoutImages",method:"POST",headers:{"content-type":"application/json","cache-control":"no-cache"},processData:false,data:e};var r=this;sap.ui.core.BusyIndicator.show();$.ajax(a).done(function(e){var a=e;console.log(a);for(var l in a){if(a.hasOwnProperty(l)){a[l].deviceCategory=a[l].deviceCategory.replace(/^0+/,"");a[l].createdDate=a[l].createdDate.split("T")[0].concat(" ").concat(a[l].createdDate.split("T")[1].substring(0,8));a[l].upadateDate=a[l].upadateDate.split("T")[0].concat(" ").concat(a[l].upadateDate.split("T")[1].substring(0,8));a[l].ui5User=a[l].ui5User.toUpperCase();var s=a[l].status;console.log(s);if(a[l].status==1){a[l].status="بأنتظار الموافقة"}if(a[l].status==2){a[l].status="تمت الموافقة"}if(a[l].status==4){a[l].status="تعليق"}}}console.log(a);var p=new sap.ui.model.json.JSONModel;var c=a;p.setData(c);i=p.getProperty("/");console.log(p);var n,i,u,y;n=r.createColumnConfig();console.log(n);u={workbook:{columns:n},dataSource:i};y=new t(u);y.build().then(function(){o.show("Spreadsheet export has finished")}).finally(y.destroy);sap.ui.core.BusyIndicator.hide()})},createColumnConfig:function(){var e=[{label:"الجولة",property:"mru",scale:0},{label:"تاريخ التعين",property:"mruAssignDt",scale:0},{label:"رقم الملف",property:"vrefer",scale:0},{label:"رابط البيانات",property:"anlage",scale:0},{label:"رقم العقد",property:"contract",scale:0},{label:"تاريخ الانشاء",property:"createdDate",scale:0},{label:"اسم المشترك",property:"customeName",scale:0},{label:"رقم التجهيزات",property:"lequnr",scale:0},{label:"رقم العداد القديم",property:"geraet",scale:0},{label:"القراءة المستجرة ساب",property:"limpMeterRead",scale:0},{label:"القراءة المصدرة ساب",property:"lexpMeterRead",scale:0},{label:"تاريخ اخر قراءة ساب",property:"lmrDateFormat",scale:0},{label:"نوع العداد",property:"meterCats",scale:0},{label:"قراءة الرفع المستجرة",property:"oimpMeterRead",scale:0},{label:"قراءة الرفع المصدرة",property:"oexpMeterRead",scale:0},{label:"الفاز",property:"phaz",scale:0},{label:"رقم العداد الجديد",property:"rmeterNo",scale:0},{label:"قراءة التركيب المستجرة",property:"rimpMeterRead",scale:0},{label:"قراءة التركيب المصدرة",property:"rexpMeterRead",scale:0},{label:"ملاحظة العداد الجديد",property:"newMeterNote",scale:0},{label:"ملاحظة العداد القديم",property:"oldMeterNote",scale:0},{label:"نوع الاشتراك",property:"ttypbez",scale:0},{label:"الفنى",property:"ui5User",scale:0}];return e}})});